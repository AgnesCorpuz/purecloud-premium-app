<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <title>PureCloud Supervisor view</title>

    <link href='//fonts.googleapis.com/css?family=Lato:300,400' rel='stylesheet' async type='text/css'>
    <link rel="stylesheet" href="style.css">

    <script src="https://code.jquery.com/jquery-2.1.4.min.js"></script>
    <script src="https://sdk-cdn.mypurecloud.com/client-apps/1.0.0/purecloud-client-app-sdk.js"></script>
    <script src="https://sdk-cdn.mypurecloud.com/javascript/28.0.0/purecloud-platform-client-v2.min.js"></script>
</head>
<body>
    <h1 id="txtQueue"></h1>
    <div>        
        <div style="margin-bottom: 20px">
            <div id="txtSubscribe" class="floating field-title" style="display: inline-block;"></div>
            <select id="ddlQueues" name="queues" onChange="subscribeToQueue()" style="display: inline-block;" dir="ltr"></select>
        </div>
        <table id="tblCallerDetails">
            <thead>
                <tr>
                    <th id="txtConvId" style="display: none"></th>
                    <th id="txtName"></th>
                    <th id="txtANI"></th>
                    <th id="txtDNIS"></th>
                    <th id="txtState"></th>
                    <th id="txtWait"></th>
                    <th id="txtDuration"></th>
                </tr>
            </thead>
            <tbody>

            </tbody>
        </table>        
    </div>

    <script type="module">
        import clientApp from './client_app.js';

        var queryString = window.location.search.substring(1);
        var pairs = queryString.split('&');
        var langTag = null;
        var pcEnv = null;
        for (var i = 0; i < pairs.length; i++)
        {
            var currParam = pairs[i].split('=');
            if(currParam[0] === 'langTag') {
                langTag = currParam[1];
            } else if(currParam[0] === 'pcEnvironment') {
                pcEnv = currParam[1];
            } else if(currParam[0] === 'environment' && pcEnv === null) {
                pcEnv = currParam[1];
            }
            
            if (langTag !== null) {
                $.getJSON('./language.json', function(data) {
                    $("#txtQueue").text(data[langTag].Queues);
                    $("#txtSubscribe").text(data[langTag].Subscribe + ": ");
                    $("#txtConvId").text(data[langTag].ConversationID);
                    $("#txtName").text(data[langTag].Name);
                    $("#txtANI").text(data[langTag].ANI);
                    $("#txtDNIS").text(data[langTag].DNIS);
                    $("#txtState").text(data[langTag].State);
                    $("#txtWait").text(data[langTag].WaitTime);
                    $("#txtDuration").text(data[langTag].Duration);
                });
            }
        }

        if(langTag === null){
            $.getJSON('./language.json', function(data) {
                $("#txtQueue").text(data["en-us"].Queues);
                $("#txtSubscribe").text(data["en-us"].Subscribe + ": ");
                $("#txtConvId").text(data["en-us"].ConversationID);
                $("#txtName").text(data["en-us"].Name);
                $("#txtANI").text(data["en-us"].ANI);
                $("#txtDNIS").text(data["en-us"].DNIS);
                $("#txtState").text(data["en-us"].State);
                $("#txtWait").text(data["en-us"].WaitTime);
                $("#txtDuration").text(data["en-us"].Duration);
            });
        }
        
        clientApp.setup(pcEnv, langTag, "supervisor.html");
        clientApp.loadSupervisorView();
        clientApp.purecloudClientApi = new window.purecloud.apps.ClientApp();

        window.clientApp = clientApp;
    </script>
    <script>
        function subscribeToQueue() {
            var queue = document.getElementById("ddlQueues");
            var queueValue = document.getElementById("ddlQueues").value;
            var queueText = queue.options[queue.selectedIndex].text;

            clientApp.subscribeToQueue(queueValue);
        }
    </script>
</body>
</html>
